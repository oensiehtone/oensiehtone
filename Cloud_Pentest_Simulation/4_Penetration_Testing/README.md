# 4. Penetration Testing

This section documents the exploitation phase of the project. The objective was to compromise the Windows client, extract the Nextcloud synchronisation token, and execute a full Man-in-the-Cloud (MitC) attack.

The attack followed a structured workflow: reconnaissance, credential compromise, remote access, token extraction, and cloud data exfiltration.

---

## 4.1 Reconnaissance and Initial Access

Network scanning identified SMB (port 445) exposed on the Windows client. Enumeration revealed the local **Administrator** account as a viable target.

A brute-force attack was performed using Hydra with a common password list, successfully identifying weak credentials. These credentials were then used within Msfconsole to establish a remote Meterpreter session.

```bash
nmap -sV -p- 192.168.1.10
hydra -l Administrator -P passwords.txt smb://192.168.1.10
```

### Evidence – Credential Compromise and Remote Access (Figure 117)

<img width="600" height="541" alt="image" src="https://github.com/user-attachments/assets/7f26451c-e018-45b6-aaea-4edc4b374226" />


This provided authenticated remote control of the Windows client.

---

## 4.2 Token Discovery and Extraction (Mimikatz)

With remote access established, the focus shifted to extracting the Nextcloud synchronisation token.

Mimikatz was uploaded to the compromised client via the active session and executed to retrieve stored credentials and token data.

The synchronisation token was successfully extracted in hexadecimal format.

### Evidence – Mimikatz Revealing Synchronisation Token

<img width="623" height="21" alt="image" src="https://github.com/user-attachments/assets/206372ad-a59f-40a8-b8d9-c24bd60bdd45" />
<img width="600" height="541" alt="image" src="https://github.com/user-attachments/assets/299c904f-d720-4a14-9119-55d8f133dc78" />

---

## 4.3 Token Decoding

The extracted token appeared in hexadecimal format and required decoding before use.

```bash
echo <HEX_TOKEN> | xxd -r -p
```

This revealed the usable Nextcloud synchronisation token.

---

## 4.4 MitC Execution – Cloud Access

The decoded token was used to authenticate directly against the Nextcloud API, bypassing password-based authentication entirely.

```bash
curl -u "Administrator:<TOKEN>" https://<server>/remote.php/dav/files
```

### Result
- Direct cloud storage access achieved
- File listing and extraction successful
- No password re-entry required
- Authentication controls bypassed

### Evidence – Cloud Storage Access (Victim Data Revealed)

<img width="600" height="541" alt="image" src="https://github.com/user-attachments/assets/ded4f184-1b96-418e-b482-823a6bd161cc" />


This demonstrates MITRE ATT&CK technique **T1528 – Steal Application Access Token**, forming the core of the MitC compromise.

---

## 4.5 Clearing Tracks

To complete the exploitation cycle:

- Meterpreter session terminated
- Uploaded tools removed
- Temporary files deleted

This simulated responsible session closure and trace reduction.

---

## 4.6 Summary and Outcome

The penetration testing phase successfully achieved the primary objective:

- Identified exposed SMB service
- Discovered Administrator account via enumeration
- Brute-forced weak credentials
- Established remote access
- Uploaded and executed Mimikatz
- Extracted and decoded the synchronisation token
- Used the token to access and extract cloud data
- Bypassed authentication controls entirely

The MitC attack was fully replicated within a controlled lab environment, demonstrating how weak identity management and exposed token storage can result in complete cloud compromise.

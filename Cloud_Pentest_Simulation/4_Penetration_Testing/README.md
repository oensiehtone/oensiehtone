# 4. Penetration Testing

This section documents the exploitation phase of the project. The objective was to compromise the Windows client, extract the Nextcloud synchronisation token, and perform a full Man-in-the-Cloud (MitC) attack.

The testing followed a structured workflow: reconnaissance, initial access, post-exploitation, token extraction, and cloud data exfiltration.

## 4.1 Reconnaissance and Enumeration

Network scanning was conducted to identify exposed services and potential entry points.

### Commands Used
```bash
nmap -sV -p- 192.168.1.10
```

### Findings
- SMB (port 445) exposed
- Usernames identified, including the local Administrator and Guesst account
- Service version information revealed

This confirmed SMB as a viable initial access vector.

## 4.2 Credential Brute Force (Initial Access)

Using the discovered username, a brute-force attack was conducted against the SMB service using a common password list.

<img width="964" height="905" alt="image" src="https://github.com/user-attachments/assets/0712364c-ffec-4fba-9a0b-ce04df83c1ab" />

### Command Used
```bash
hydra -l Administrator -P passwords.txt smb://192.168.1.10
```

### Outcome
- Weak password successfully cracked
- Valid SMB credentials obtained
- Remote authentication confirmed

This provided authenticated access to the Windows client.

## 4.3 Remote Exploitation with Msfconsole

With valid credentials established, exploitation was escalated using Metasploit.

### Actions Performed
- Meterpreter session established against the client
- Confirmed remote shell access
- Uploaded post-exploitation tools from attacker VM

This provided controlled remote access to the target system.

## 4.4 Iteration 1 – Manual Token Discovery

Before using automated tooling, multiple methods were tested to locate the Nextcloud synchronisation token:

- Searching configuration directories
- Reviewing log files
- Inspecting application data folders

The token was ultimately identified within Windows Credential Manager.

This confirmed that the attack path was viable and that token-based authentication could be abused.

## 4.5 Iteration 2 – Mimikatz Token Extraction (Successful)

To automate credential and token extraction, Mimikatz was uploaded to the compromised client via the active Meterpreter session.

### Key Actions
- Uploaded Mimikatz executable from attacker VM
- Executed Mimikatz remotely
- Dumped stored credentials and synchronisation token
- Extracted token in hexadecimal format

The token was then copied and decoded using the terminal:

```bash
echo <HEX_TOKEN> | xxd -r -p
```

This revealed the usable Nextcloud synchronisation token.

## 4.6 MitC Execution – Token Reuse and Data Exfiltration

The decoded token was used to authenticate directly against the Nextcloud API, bypassing standard login procedures.

### Example Command
```bash
curl -u "Administrator:<TOKEN>" https://<server>/remote.php/dav/files
```

### Result
- Direct access to cloud storage
- File listing and extraction successful
- No password re-entry required
- Authentication controls bypassed

This demonstrates MITRE ATT&CK technique **T1528 – Steal Application Access Token**, forming the basis of the MitC compromise.

## 4.7 Clearing Tracks

To complete the CEH methodology cycle, cleanup actions were performed:

- Meterpreter session terminated
- Uploaded tools removed
- Temporary files deleted

This simulated responsible session closure and attack trace reduction.

## 4.8 Summary and Outcome

The penetration testing phase successfully achieved the primary project objective:

- Identified exposed SMB service
- Discovered valid usernames via enumeration
- Brute-forced weak Administrator credentials
- Gained authenticated remote access
- Uploaded and executed Mimikatz
- Extracted and decoded the Nextcloud synchronisation token
- Used the token to access and extract cloud data
- Bypassed authentication controls entirely

The MitC attack was fully replicated in a controlled environment, demonstrating how weak identity controls and token-based authentication can result in complete cloud compromise.

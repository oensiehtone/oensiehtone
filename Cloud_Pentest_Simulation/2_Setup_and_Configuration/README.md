# 2. Setup and Configuration

This section outlines how the environment was deployed and configured to enable the MitC attack simulation. It focuses on practical setup tasks and key configuration work, without repeating architectural details covered in Section 1.

## 2.1 Initial VirtualBox Prototyping

The project began with VirtualBox to prototype the early environment and test basic communication between:
- A Windows 10 client
- An attacker VM
- A prototype cloud server

### Limitations Encountered
- Unstable networking
- VM crashes under load
- Limited suitability for multi-service cloud testing

These issues led to migration to a more robust platform.

## 2.2 Migration to Proxmox VE

Proxmox was adopted for:
- Greater stability
- Better VM isolation
- Support for nested virtualisation
- More realistic cloud-style workflows

### Hypervisor Troubleshooting
Nested virtualisation required enabling features at OS and BIOS level:

```powershell
Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V-All
bcdedit /set hypervisorlaunchtype auto
```

Snapshot recovery was used frequently during VM instability, improving understanding of virtualisation reliability.

## 2.3 Deployment of Nextcloud and IAM Services

The objective was to pair a cloud storage platform with an IAM system to simulate a realistic identity-linked attack.

### Deployment Notes
- The official Nextcloud AIO image could not be imported into Proxmox
- TurnKey Linux ISOs were successfully used for:
  - Nextcloud
  - Directory Services (Zentyal-equivalent)

### IAM & Nextcloud Integration
- DNS issues on Zentyal were fixed by updating `/etc/hosts`
- Nextcloud LDAP connector was configured
- Case-sensitivity and attribute-mapping issues were resolved
- A dedicated LDAP “Connector” service account was created

## 2.4 Windows 10 Client Configuration

The Windows client acted as the victim endpoint in the MitC attack chain.

### Setup Tasks
- Installed the Nextcloud desktop sync client
- Joined the client to the Zentyal-managed domain
- Allowed default token storage in Credential Manager (intentionally insecure)
- Applied minimal hardening to preserve expected vulnerabilities

This ensured the Nextcloud token would be generated and stored locally, forming the primary target for the attack.

## 2.5 Attacker VM Preparation

A Kali Linux virtual machine was configured with the tools required for reconnaissance, exploitation, and token-based exfiltration.

### Tools Installed
```bash
sudo apt install nmap hydra crackmapexec smbclient curl
```

These tools were later used for SMB brute forcing, enumeration, and MitC-style data access.

## 2.6 System Readiness

By the end of configuration:
- IAM and cloud services were fully operational
- Nextcloud sync workflow was functioning normally
- The Windows client generated valid sync tokens and stored them locally
- The attacker VM had visibility of required services
- The environment was stable, isolated, and intentionally vulnerable

This completed the setup phase and prepared the system for exploitation in Section 4.
